The Build Directory
===================

This folder contains the scripts and supporting resources for those scripts. After you run the scripts, the products will appear in this directory as well.


Before You Build
================

You will need to have installed git, Python 3, and LaTeX.

(On a Mac, you should install Xcode (from the app store, which should include Git) and `brew <https://brew.sh>`_. Next::

  brew install python
  brew install mactex-no-gui

Clone the github repository::

  git clone https://github.com/TheKontinua/sequence.git

You will also need some fonts from the `Google Font Collection <https://fonts.google.com/>`_ :

* Marcellus Regular
* Marcellus SC Regular
* OpenSans Bold
* OpenSans Bold Italic
* OpenSans Semi Bold

To build the web resources, you will need some Python libraries::

  pip3 install jinja2
  pip3 install bs4

Windows
-------------

Mac is preferred, but if you only have access to a Windows device, the following steps must be taken in addition to downloading fonts and libraries:

* Download and install `MiKTex <https://miktex.org/download>`_.
* Download and install `Git Bash <https://git-scm.com/downloads>`_.
* Download and install `Python <https://www.python.org/downloads/>`_.
* Clone the github repository::

  git clone https://github.com/TheKontinua/sequence.git

* Go to your clone location and open ``sequence\Build\Support\default.cfg``. Replace ``/Library/TeX/texbin/lualatex`` with ``lualatex``.

Contributing
------------

If you are planning on contributing, you will need to setup SSH keys and access for Github. You can find info `here <https://docs.github.com/en/authentication/connecting-to-github-with-ssh>`_.

Once SSH access is configured, you need to clone from the SSH repo::

  git clone git@github.com:KontinuaFoundation/sequence.git

It may ask to trust ``github.com``, say yes.

Configuration
-------------

The first time you run any of these scripts, a ``user.cfg`` will be
created. It contains the user’s preferences, mainly paper size and
language preferences.

If you are committing changes, please don’t commit your ``user.cfg``
file to the repository.

Scripts
-------

-  | ``build_workbook.py``: Builds PDFs of the workbooks. It takes one
     argument: A book number (like 5) or ``all``. The books will appear
     in the ``Workbooks`` directory.
   | Example: ``python3 build_workbook.py 5``

-  | ``build_chapter.py``: Used by authors to build just the chapter
     they are working on. Invoked from a directory with a
     ``student.tex`` file. Results in a ``draft.pdf`` file.
   | Example: ``python3 ../../../Build/build_chapter.py``

-  | ``check_urls.py``: Used to check all the URLs in the
      ``digital_resources.json`` files. Also looks up the title of each.
    | Example: ``python3 check_urls.py 1``

-  | ``make_chapter_pdfs.py``: Used to build pdfs of each chapter.
    This takes a while to run.
    | Example: ``python3 make_chapter_pdfs.py en_US``

-  | ``gather_resources.py``: Builds an HTML document for each workbook.
     The files will be created in the ``Resources-en_US`` directory.
    Run ``check_urls.py`` first -- it uses the titles.
   | Example: ``python3 gather_resources.py``

-  | ``gather.py``: Builds a json document for each workbook and a topic index for the whole collection.
        The files will be created in the ``Resources-en_US`` directory.
       Run ``check_urls.py`` first -- it uses the titles.
       Also run ``build_workbook.py all``, it uses the intermediate LaTeX files
   | Example: ``python3 gather.py``

-  | ``clean.py``: Deletes a intermediate files and all PDF/HTML files
     that are generated by the other scripts, including ``draft.pdf``
     files in the chapter directories.
   | Example: ``python3 clean.py``

-  | ``build_chapterlist.py``: creates ``Resources/chaplist.txt`` which
     contains the titles of every chapter for every book.
   | Example: ``python3 build_chapterlist.py``

Status
------

All these scripts work, but the support for localization is incomplete.
Once we start localizing the materials, we will correct this
situation.

Committing
----------

Overall, most authors shouldn’t be committing anything in the ``Build``
directory; they should work under the ``Chapters`` directory.
